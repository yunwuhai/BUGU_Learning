# 第一次培训

[TOC]

## 工程基础配置

### 芯片选择

![image-20210714150629316](../pic/第一次培训/image-20210714150629316.png)

选择芯片的界面，我们可以通过不同的分类进行选择。

STM32，基本上都是使用的ARM架构，我们使用的ST32F407VET6，架构是ARM Cortex-M4。STM32常见的芯片STM32F1系列、STM32F4系列。

M4比M3多DSP，浮点运算或者说一些计算功能更加优于MPU（单片机），主要应用于一些需要快速计算的场合或浮点运算场合，例如FFT。

F407是STM32里中端芯片中比较好的一种。

### cubeMX

![image-20210714151606764](../pic/第一次培训/image-20210714151606764.png)

STM32cubeMX本身是一个单独的产品，它被作为一部分，整合进了STM32CubeIDE。

首先我们配置SYS和RCC，然后选择时钟源为外部高速时钟，配置HCLK为最高速。

## 系统配置

在上面的CubeMX配置完成后点击生成按钮，就会根据我们的配置生成一堆代码，接下来我们可以看到主函数（main()）中，自动生成的语句中，第一个是`HAL_Init`，第二个是`SystemClock_Config`，它们的功能分别为系统初始化和时钟配置。其中`HAL_Init`是初始化和HAL库相关的内部配置，如果不使用HAL库，可以不使用这个代码，否则必须要使用。系统时钟配置一定要设置，无论在任何单片机上。

然后接下来可以看见生成了外设的初始化函数。按住`Ctrl+鼠标点击`可以跳转到该函数的定义界面，如果再点击一次，就可以看到它的声明界面。

注意，如果再CubeMX中设置了外设分离.h和.c文件的配置，则这些外设初始化函数会定义在和外设同名的.c和.h文件中。

## HAL的理解

硬件抽象层。

平常我们需要从应用层面去分析我们的需求，然后把它转换成一种概念性的东西。我们就知道要用哪一种外设。

但是对于芯片来说，没有外设、应用这些概念，在设计之初，只有一堆寄存器和一堆存储器等基础器件。

最开始有种东西叫标准库，去封装了一堆宏定义，除此之外还设计了一些设置方法。

MSP芯片支持报-》BSP板级支持包-》HAL硬件抽象层

STM32F407VE

STM32F103C8

封装一个函数叫HAL_MspInit，不同的芯片封装起来这个函数的实现方法可能是不一样的，但是名字统一，那么我们只需要调取这个名字，就可以实现响应的功能。

## GPIO

对于LED，我们的引脚功能应该设置为输出。故选择对应引脚进行点击配置，配置的时候如果找不到引脚，可以在右下方的搜索栏里搜索。

GPIO可以控制输入和输出，对于输出来说没有所谓中断的说法，但是对于输入来说有中断，中断的来源可能是在检测外部信号的时候外部来了一个下降脉冲或者上升的脉冲或者其它信号就会进入中断函数，然后中断函数会调用回调函数，我们可以在回调函数里面执行响应的功能。

GPIO控制输出的时候仅为逻辑电平，即高电平（VCC，3.3），低电平GND。

## 本次任务

完善Blink_3LED功能，命名方式为Test1_Blink_3LED_后缀。

最终实现效果：

找三个GPIO引脚作为输入中断（上升下降电平都中断），然后讲其命名为SW_RED\GREEN\BLUE，分别代表了GPIO的电平，如果为上升电平，则将对应的LED点亮，下降则熄灭。使用HAL库，如果能使用LL库最好。

除此之外，使用USART1封装一个printf。注意\_\_weak，使用这个东西去重定向fputc，以实现重定向printf。网上搜的时候，关键字为fputc+重定向或者printf+重定向（重定义）之类的搜索。

下一次是三天后的晚上八点

